<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>¬°Feliz Cumplea√±os Mayka! ü•≥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            min-height: 100vh;
            overflow-x: hidden;
            touch-action: manipulation;
            color: #333;
        }

        .screen {
            display: none;
            min-height: calc(100vh - 70px); 
            padding: 20px;
            text-align: center;
            overflow-y: auto;
            align-items: center; 
        }

        .screen.active {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .screen h2 { color: #555; margin-bottom: 20px; font-size: 1.8rem; }
        .screen h3 { color: #666; margin-bottom: 10px; font-size: 1.3rem; }

        /* Navegaci√≥n inferior */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); display: flex; justify-content: space-around; padding: 8px 0; border-top: 2px solid rgba(255,255,255,0.3); z-index: 1000; box-shadow: 0 -5px 15px rgba(0,0,0,0.1); }
        .nav-btn { background: none; border: none; font-size: 1.8rem; padding: 8px 12px; cursor: pointer; transition: transform 0.2s, color 0.2s; border-radius: 50%; color: #777; }
        .nav-btn:active { transform: scale(0.9); }
        .nav-btn.active { color: #ff6b6b; transform: scale(1.1); }
        .nav-btn.nav-gift.active { background: linear-gradient(45deg, #ff6b6b, #feca57); color: white; border-radius: 15px; }

        /* Pantalla de Inicio */
        .welcome-screen {
            color: white;
            position: relative;
            overflow: hidden;
            min-height: 100vh;
        }
        #welcomeVideoBg {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: translate(-50%, -50%);
            z-index: -1; 
            filter: brightness(0.7); 
        }

        .welcome-screen::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; font-size: 3rem; opacity: 0.1; animation: float 6s ease-in-out infinite; z-index: 0; }
        .welcome-content { z-index: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .welcome-title { font-size: 2.5rem; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); opacity: 0; }
        .welcome-title span { display: inline-block; opacity: 0; transform: translateY(20px); transition: opacity 0.5s ease, transform 0.5s ease; }
        .luna-with-cake { margin: 20px 0; opacity: 0; transform: scale(0.5); transition: opacity 0.8s ease-out, transform 0.8s ease-out; position: relative; }
        .luna-with-cake img { width: 150px; height: auto; display: block; }
        .cake-emoji { position: absolute; font-size: 2.8rem; bottom: 35%; left: 55%; transform: translateX(-50%) rotate(-10deg); text-shadow: 1px 1px 3px rgba(0,0,0,0.2); }
        .welcome-subtitle { font-size: 1.2rem; margin-bottom: 30px; opacity: 0; transition: opacity 0.8s ease-in 0.5s; padding: 0 10px; text-shadow: 1px 1px 3px rgba(0,0,0,0.4); }
        .start-btn { background: linear-gradient(45deg, #ff6b6b, #feca57); color: white; border: none; padding: 15px 30px; font-size: 1.3rem; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 8px 25px rgba(0,0,0,0.2); touch-action: manipulation; opacity: 0; transition: opacity 0.8s ease-in 1s; }
        .start-btn:active { transform: scale(0.95); }

        /* Zona del Juego */
        .game-screen { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); position: relative; }
        .game-container { max-width: 100%; margin: 0 auto; padding: 0 10px; }
        .stats-bar { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; background: rgba(255,255,255,0.9); padding: 15px; border-radius: 20px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .stat { display: flex; flex-direction: column; align-items: center; gap: 5px; font-weight: bold; font-size: 0.9rem; }
        .stat span:first-child { font-size: 1.2rem; }
        .stat-bar { width: 80px; height: 8px; background: #ddd; border-radius: 4px; overflow: hidden; }
        .stat-fill { height: 100%; transition: width 0.5s ease; border-radius: 4px; }
        .happiness-fill { background: #ff6b6b; } .energy-fill { background: #4ecdc4; } .hunger-fill { background: #45b7d1; }
        .luna-container { position: relative; height: 220px; margin: 20px 0; display: flex; justify-content: center; align-items: center; }
        .luna { width: 180px; height: 180px; position: relative; margin: 0 auto; cursor: pointer; display: flex; justify-content: center; align-items: center; }
        #lunaImg { max-width: 100%; max-height: 100%; object-fit: contain; animation: bobbing 3s ease-in-out infinite; transition: transform 0.2s ease; }
        #lunaImg:active { transform: scale(1.1); }
        @keyframes bobbing { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
        
        .luna-accessory { 
            position: absolute;
            left: 50%;
            font-size: 2.5rem; 
            z-index: 10;
            pointer-events: none;
            animation: bobbingAccessoryFullSize 3s ease-in-out infinite; 
        }
        @keyframes bobbingAccessoryFullSize { 
            0%, 100% { transform: translate(-50%, -80px); } /* ANTES: -15px. Prueba con -60px a -70px */
            50% { transform: translate(-50%, -88px); }    /* ANTES: -23px. (-65px - 8px) */
        }

        .action-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; width: 100%; max-width: 400px; }
        .action-btn { background: rgba(255,255,255,0.9); border: none; padding: 15px 10px; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; font-size: 1rem; box-shadow: 0 5px 15px rgba(0,0,0,0.1); touch-action: manipulation; }
        .action-btn small { font-size: 0.75rem; color: #555; }
        .action-btn:active { transform: scale(0.95); } .action-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Minijuegos */
        .minigames-screen { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
        .game-selector { display: grid; grid-template-columns: 1fr; gap: 20px; margin: 20px 0; width: 100%; max-width: 350px; }
        .game-card { background: rgba(255,255,255,0.9); padding: 20px; border-radius: 20px; cursor: pointer; transition: transform 0.3s ease; box-shadow: 0 5px 15px rgba(0,0,0,0.1); touch-action: manipulation; }
        .game-card:active { transform: scale(0.95); } .game-card h3 { font-size: 1.2rem; margin-bottom: 10px; color: #ff6b6b; } .game-card p { font-size: 0.9rem; color: #555; }
        #memoryGameContainer, #wordleGameContainer { width: 100%; max-width: 350px; }
        .memory-game { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; max-width: 300px; margin: 20px auto; }
        .memory-card { aspect-ratio: 1; background: #fff; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; transition: transform 0.3s ease, background-color 0.3s; box-shadow: 0 2px 10px rgba(0,0,0,0.1); touch-action: manipulation; transform-style: preserve-3d; }
        .memory-card .card-face { position: absolute; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; backface-visibility: hidden; border-radius: 10px; }
        .memory-card .card-front { background: #fff; color: #fff; } .memory-card .card-back { background: #4ecdc4; transform: rotateY(180deg); color: white; }
        .memory-card.flipped { transform: rotateY(180deg); } .memory-card.matched { transform: rotateY(180deg); background: #27ae60 !important; } .memory-card.matched .card-back { background: #27ae60; }
        .wordle-game { max-width: 300px; margin: 20px auto; }
        .wordle-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-bottom: 15px; }
        .wordle-cell { aspect-ratio: 1; border: 2px solid #ddd; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; font-weight: bold; text-transform: uppercase; background-color: #fff; transition: background-color 0.3s, border-color 0.3s, color 0.3s, transform 0.3s; }
        .wordle-cell.filled { transform: scale(1.1); } .wordle-cell.correct { background: #27ae60; color: white; border-color: #27ae60; }
        .wordle-cell.present { background: #f39c12; color: white; border-color: #f39c12; } .wordle-cell.absent { background: #7f8c8d; color: white; border-color: #7f8c8d; }
        #wordleInput { width: 100%; padding: 10px; margin: 10px 0; border-radius: 10px; border: 2px solid #ddd; text-align: center; font-size: 1.2rem; text-transform: uppercase; font-family: 'Comic Sans MS', cursive, sans-serif; }
        #wordleInput::placeholder { text-transform: none; }

        /* Personalizaci√≥n */
        .customize-screen { background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); }
        .luna-preview-container { position: relative; width: 150px; height: 150px; margin: 10px auto 20px; display: flex; justify-content: center; align-items: center; }
        #lunaPreviewImg { max-width: 100%; max-height: 100%; object-fit: contain; animation: bobbing 3s ease-in-out infinite; }
        #lunaAccessoryPreview { 
            position: absolute;
            left: 50%;
            font-size: 2rem; 
            z-index: 10;
            pointer-events: none;
            animation: bobbingAccessoryPreview 3s ease-in-out infinite; 
        }
        @keyframes bobbingAccessoryPreview { 
            0%, 100% { transform: translate(-50%, -70px); } /* ANTES: -10px. Prueba con -50px a -60px */
            50% { transform: translate(-50%, -78px); }    /* ANTES: -18px. (-55px - 8px) */
        }
        .accessory-picker { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0; width: 100%; max-width: 300px; }
        .accessory-option { padding: 15px; background: rgba(255,255,255,0.9); border-radius: 15px; cursor: pointer; font-size: 2rem; border: 3px solid transparent; transition: all 0.3s ease; touch-action: manipulation; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .accessory-option.text-label { font-size: 0.9rem; font-weight: bold; }
        .accessory-option:active { transform: scale(0.95); }
        .accessory-option.selected { border-color: #ff6b6b; transform: scale(1.05); box-shadow: 0 0 10px rgba(255,107,107,0.5); }

        /* Galer√≠a */
        .gallery-screen { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .gallery-screen h2, .gallery-screen p { color: white; }
        .gallery-container { width: 100%; max-width: 360px; margin: 20px auto; background: rgba(255,255,255,0.95); border-radius: 20px; padding: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.2); display: flex; flex-direction: column; align-items: center; }
        .gallery-image-wrapper { width: 100%; aspect-ratio: 16/10; background: #e0e0e0; border-radius: 15px; overflow: hidden; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; border: 3px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
        #galleryImage { max-width: 100%; max-height: 100%; object-fit: cover; display: block; }
        #galleryMessage { font-size: 0.95rem; color: #444; margin-top: 5px; margin-bottom: 15px; padding: 0 10px; min-height: 40px; line-height: 1.4; }
        .gallery-controls { display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 0 10px; }
        .gallery-nav-btn { background: linear-gradient(45deg, #ff8a8a, #fca557); color: white; border: none; padding: 10px 18px; border-radius: 25px; font-size: 1rem; cursor: pointer; box-shadow: 0 3px 8px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .gallery-nav-btn:hover { transform: translateY(-2px); } .gallery-nav-btn:active { transform: translateY(0px); } .gallery-nav-btn:disabled { background: #cccccc; cursor: not-allowed; box-shadow: none; }
        #galleryCounter { font-size: 0.9rem; color: #666; font-weight: bold; }

        /* Efectos especiales */
        .hearts { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: none; z-index: 5; }
        .heart { position: absolute; color: #ff6b6b; font-size: 1.5rem; animation: floatUp 2s ease-out forwards; }
        .floating-text { position: absolute; top: 30%; left: 50%; transform: translate(-50%, -50%); color: #fff; background-color: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 10px; font-size: 1.2rem; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.7); pointer-events: none; animation: fadeUp 2s ease-out forwards; z-index: 10; }

        /* Zona de Regalo */
        .gift-screen { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
        .gift-screen h2, .gift-screen h3 { color: white; }
        .gift-box { width: 150px; height: 150px; background: #ff6b6b; border-radius: 20px; margin: 30px auto; position: relative; cursor: pointer; transition: transform 0.3s ease; animation: bounce 2s infinite; touch-action: manipulation; }
        .gift-box:active { transform: scale(1.1); } .gift-box::before { content: 'üéÅ'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 3rem; }
        .message-box { background: rgba(255,255,255,0.95); color: #333; padding: 20px; border-radius: 20px; margin: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); text-align: left; max-width: 500px; }
        .message-box h3 { color: #f5576c; } .message-box h4 { color: #764ba2; margin-top: 15px; } .message-box p { line-height: 1.6; }
        .download-btn { background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-size: 1rem; transition: all 0.3s ease; margin: 10px 5px; touch-action: manipulation; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .download-btn:active { transform: scale(0.95); }

        /* Animaciones */
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-20px); } }
        @keyframes floatUp { 0% { opacity: 1; transform: translate(-50%, -50%) translateY(0); } 100% { opacity: 0; transform: translate(-50%, -50%) translateY(-80px); } }
        @keyframes fadeUp { 0% { opacity: 1; transform: translate(-50%, -50%) translateY(0); } 100% { opacity: 0; transform: translate(-50%, -50%) translateY(-40px); } }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-15px); } 60% { transform: translateY(-8px); } }

        /* Estados de Luna */
        .luna.sleeping #lunaImg { animation: none; opacity: 0.8; transform: rotate(15deg) translateY(10px); }
        .luna.playing #lunaImg { animation: bounce 0.5s ease-in-out 3, bobbing 3s ease-in-out infinite; }
        .luna.eating #lunaImg { animation: pulse 0.3s ease-in-out 5, bobbing 3s ease-in-out infinite; }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center; padding: 15px; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 25px; border-radius: 20px; margin: 20px; max-width: 90%; max-height: 90vh; overflow-y: auto; text-align: center; position: relative; }
        .modal-content h3 { margin-top: 0; color: #ff6b6b;} .modal-content p { margin-bottom: 15px; line-height: 1.5;}
        .close-btn { background: #ff6b6b; color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 0.9rem; position: absolute; top: 10px; right: 10px; touch-action: manipulation; }
        
        @media (max-width: 380px) {
            .welcome-title { font-size: 2rem; }
            .luna { width: 150px; height: 150px; } 
            @keyframes bobbingAccessoryFullSize { /* Ajuste para m√≥vil tambi√©n si es necesario */
                0%, 100% { transform: translate(-50%, -12px); } 
                50% { transform: translate(-50%, -20px); } 
            }
            #lunaAccessoryPreview { animation: bobbingAccessoryPreviewSmall 3s ease-in-out infinite; }
            @keyframes bobbingAccessoryPreviewSmall { 0%, 100% { transform: translate(-50%, -10px); } 50% { transform: translate(-50%, -18px); } }
            .stats-bar { padding: 10px; } .stat-bar { width: 60px; }
            .action-btn { font-size: 0.9rem; padding: 12px 8px; }
            .nav-btn { font-size: 1.6rem; padding: 8px 10px;}
            .memory-card { font-size: 1.5rem; } .wordle-cell { font-size: 1rem; }
            .luna-with-cake img { width: 120px; } .cake-emoji { font-size: 2.5rem; }
            .gallery-container { padding: 15px; } .gallery-image-wrapper { aspect-ratio: 4/3; }
            #galleryMessage { font-size: 0.9rem; }
        }
        
        .modal-content::-webkit-scrollbar { width: 5px; }
        .modal-content::-webkit-scrollbar-track { background: #f1f1f1; }
        .modal-content::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
    </style>
</head>
<body>
    <!-- Pantalla de Inicio -->
    <div class="screen welcome-screen active" id="welcomeScreen">
        <video autoplay muted loop id="welcomeVideoBg">
            <source src="fondo_bienvenida.mp4" type="video/mp4">
            Tu navegador no soporta v√≠deos HTML5.
        </video>
        <div class="welcome-content">
            <h1 class="welcome-title" id="animatedWelcomeTitle">¬°Feliz Cumplea√±os Maykita!</h1>
            <div class="luna-with-cake" id="lunaWithCake">
                <img src="LUNA.png" alt="Luna con tarta">
                <span class="cake-emoji">üéÇ</span>
            </div>
            <p class="welcome-subtitle" id="welcomeSubtitle">Te he hecho una web un poco cutre, cosas de inform√°ticos</p>
            <button class="start-btn" id="actualStartBtn" onclick="navigateTo('gameScreen', true)">EMPEZAR</button>
        </div>
    </div>

    <!-- Zona del Juego -->
    <div class="screen game-screen" id="gameScreen">
        <div class="game-container">
            <h2>¬°Cuida a Luna! üêæ</h2>
            <div class="stats-bar">
                 <div class="stat"><span>üòä</span><div class="stat-bar"><div class="stat-fill happiness-fill" id="happinessFill"></div></div><span id="happinessText">50</span></div>
                 <div class="stat"><span>‚ö°</span><div class="stat-bar"><div class="stat-fill energy-fill" id="energyFill"></div></div><span id="energyText">50</span></div>
                 <div class="stat"><span>üçΩÔ∏è</span><div class="stat-bar"><div class="stat-fill hunger-fill" id="hungerFill"></div></div><span id="hungerText">50</span></div>
            </div>
            <div class="luna-container">
                <div class="luna" id="luna" onclick="petLuna()">
                    <img id="lunaImg" src="LUNA.png" alt="Luna">
                    <div class="luna-accessory" id="lunaAccessory"></div>
                </div>
                <div class="hearts" id="hearts"></div><div class="floating-text" id="floatingText"></div>
            </div>
            <div class="action-buttons">
                <button class="action-btn" id="btnFeed" onclick="feedLuna()">üçñ Alimentar<br><small>+Hambre +Felicidad</small></button>
                <button class="action-btn" id="btnPlay" onclick="playWithLuna()">üéæ Jugar<br><small>+Felicidad -Energ√≠a</small></button>
                <button class="action-btn" id="btnBrush" onclick="brushLuna()">ü™Æ Cepillar<br><small>+Felicidad</small></button>
                <button class="action-btn" id="btnSleep" onclick="letLunaSleep()">üí§ Dormir<br><small>+Energ√≠a</small></button>
            </div>
            <div style="margin-top: 20px;"><p id="gameMessage" style="font-size:0.9rem; color: #555;">Es como el pou pero no sirve para nada</p><p id="achievementMessage" style="font-weight: bold; color: #ff6b6b; margin-top:10px; min-height: 20px;"></p></div>
        </div>
    </div>

    <!-- Minijuegos -->
    <div class="screen minigames-screen" id="minigamesScreen">
         <h2>üéÆ Minijuegos</h2>
        <div class="game-selector" id="gameSelector">
            <div class="game-card" onclick="startMemoryGame()"><h3>üß† Memoria Perruna</h3><p>Encuentra las parejas con Luna. ¬°Demuestra tu buena memoria!</p></div>
            <div class="game-card" onclick="startWordleGame()"><h3>üî§ Wordle</h3><p>Adivina palabras secretas</p></div>
        </div>
        <div id="memoryGameContainer" style="display: none;">
            <h3>üß† Juego de Memoria</h3><p>Puntuaci√≥n: <span id="memoryScore">0</span> | Intentos: <span id="memoryAttempts">0</span></p>
            <div class="memory-game" id="memoryGame"></div>
            <button class="action-btn" style="margin-top:15px;" onclick="resetMemoryGame()">üîÑ Nuevo Juego</button>
            <button class="action-btn" style="margin-top:15px; background: #feca57;" onclick="showGameSelector()">Volver</button>
        </div>
        <div id="wordleGameContainer" style="display: none;">
            <h3>üî§ Wordle</h3><p>Pista: <span id="currentWordHint"></span></p>
            <div class="wordle-game"><div class="wordle-grid" id="wordleGrid"></div><input type="text" id="wordleInput" maxlength="5" placeholder="Escribe aqu√≠..."><button class="action-btn" style="margin-top:10px;" onclick="submitWordleGuess()">Enviar Palabra</button></div>
            <button class="action-btn" style="margin-top:15px;" onclick="resetWordleGame()">üîÑ Nueva Palabra</button>
            <button class="action-btn" style="margin-top:15px; background: #feca57;" onclick="showGameSelector()">Volver</button>
        </div>
    </div>

    <!-- Personalizaci√≥n -->
    <div class="screen customize-screen" id="customizeScreen">
        <h2>‚ú® Personaliza a Luna</h2>
        <p style="margin-bottom:20px; font-size:0.9rem; color:#555;">¬°Dale a Luna un look √∫nico para tu cumple!</p>
        <div class="luna-preview-container">
            <img id="lunaPreviewImg" src="LUNA.png" alt="Preview Luna">
            <div class="luna-accessory" id="lunaAccessoryPreview"></div>
        </div>
        <h3>üëë Accesorios para Luna</h3>
        <div class="accessory-picker">
            <div class="accessory-option text-label selected" onclick="changeLunaAccessory('', this)">Ninguno</div>
            <div class="accessory-option" onclick="changeLunaAccessory('üëë', this)">üëë</div><div class="accessory-option" onclick="changeLunaAccessory('üéÄ', this)">üéÄ</div>
            <div class="accessory-option" onclick="changeLunaAccessory('üï∂Ô∏è', this)">üï∂Ô∏è</div><div class="accessory-option" onclick="changeLunaAccessory('üé©', this)">üé©</div>
            <div class="accessory-option" onclick="changeLunaAccessory('üå∏', this)">üå∏</div>
        </div>
    </div>

    <!-- Galer√≠a -->
    <div class="screen gallery-screen" id="galleryScreen">
        <h2>üì∏ Galer√≠a de Recuerdos</h2>
        <p>Las pocas fotos que tenemos</p>
        <div class="gallery-container">
            <div class="gallery-image-wrapper"><img src="" alt="Recuerdo de Mayka y Luna" id="galleryImage"></div>
            <div id="galleryMessage"></div>
            <div class="gallery-controls">
                <button class="gallery-nav-btn" id="prevImageBtn" onclick="prevGalleryImage()">‚¨ÖÔ∏è Anterior</button>
                <span id="galleryCounter"></span>
                <button class="gallery-nav-btn" id="nextImageBtn" onclick="nextGalleryImage()">Siguiente ‚û°Ô∏è</button>
            </div>
        </div>
    </div>

    <!-- Zona de Regalo -->
    <div class="screen gift-screen" id="giftScreen">
        <h2>Un regalito para ti üéÅ</h2>
        <div class="gift-box" id="giftBox" onclick="openGift()"></div>
        <div class="message-box" id="finalMessage" style="display: none;">
            <h3>üíù Mensaje de marcos üíù</h3>
            <p style="font-size: 1.2rem; line-height: 1.6; margin: 20px 0;">
                Feliz cumple tonta üêæ<br><br>
                Este a√±o me apetec√≠a hacerte una web (adem√°s de pq no fui a tu cumple el a√±o pasado), pero no me la he podido currar tanto como me hubiera gustado por todos los ex√°menes.<br><br>
                Tambi√©n la hago porque el regalo que tenia pensado me esta costando encontrarlo y al momento en el que leas esto no se si lo habr√© pedido (asi q alomejor no llega a tiempo). Igualmente hay una tonteria que tengo para darte con el regalo üéÇüéâ<br><br>
                Pero eso tata, que feliz cumplea√±os y por todos los que te quedan.ü•∞<br><br>
                <br>
                Te quiero muxo,
                Marquitos.
            </p>
            <div style="margin: 25px 0; text-align:center;"><h4>üèÜ ¬°Logros Desbloqueados en tu Aventura! üèÜ</h4><p id="achievementsList" style="font-size: 0.9rem; color: #555;"></p></div>
        </div>
    </div>

    <!-- Modal Gen√©rico -->
    <div class="modal" id="infoModal"><div class="modal-content"><button class="close-btn" onclick="closeModal()">X</button><h3 id="modalTitle" style="margin-bottom: 15px;"></h3><div id="modalBody"></div></div></div>

    <!-- Barra de Navegaci√≥n Inferior -->
    <div class="bottom-nav" id="bottomNav" style="display: none;">
        <button class="nav-btn" id="navBtnGame" onclick="navigateTo('gameScreen')">üêæ</button><button class="nav-btn" id="navBtnMinigames" onclick="navigateTo('minigamesScreen')">üéÆ</button>
        <button class="nav-btn" id="navBtnCustomize" onclick="navigateTo('customizeScreen')">‚ú®</button><button class="nav-btn" id="navBtnGallery" onclick="navigateTo('galleryScreen')">üì∏</button>
        <button class="nav-btn nav-gift" id="navBtnGift" onclick="navigateTo('giftScreen')">üéÅ</button>
    </div>

    <script>
        // --- ESTADO DEL JUEGO Y CONFIGURACI√ìN ---
        let gameState = { happiness: 50, energy: 50, hunger: 50, interactions: 0, achievements: [], giftUnlocked: false };
        let lunaCustomization = { accessory: '' };
        let actionCooldowns = { pet: false, feed: false, play: false, brush: false, sleep: false };
        const COOLDOWN_TIME = 2000; 
        let currentScreenId = 'welcomeScreen';
        let statInterval;
        const lunaImgElement = document.getElementById('lunaImg'); 
        const lunaPreviewImgElement = document.getElementById('lunaPreviewImg');
        const bottomNav = document.getElementById('bottomNav');

        // --- ANIMACI√ìN DE BIENVENIDA ---
        function animateWelcome() {
            const title = document.getElementById('animatedWelcomeTitle');
            const lunaCake = document.getElementById('lunaWithCake');
            const subtitle = document.getElementById('welcomeSubtitle');
            const startButton = document.getElementById('actualStartBtn');
            const text = title.textContent;
            title.innerHTML = ''; title.style.opacity = 1;
            let delay = 0;
            text.split('').forEach(char => {
                const span = document.createElement('span');
                span.textContent = char; if (char === ' ') span.style.width = '0.5ch'; 
                title.appendChild(span);
                setTimeout(() => { span.style.opacity = 1; span.style.transform = 'translateY(0)'; }, delay);
                delay += 60; 
            });
            setTimeout(() => { lunaCake.style.opacity = 1; lunaCake.style.transform = 'scale(1)'; }, delay + 300);
            setTimeout(() => { subtitle.style.opacity = 1; startButton.style.opacity = 1; }, delay + 800);
        }
        
        // --- NAVEGACI√ìN ENTRE PANTALLAS ---
        function navigateTo(screenId, isGameStart = false) {
            if (currentScreenId === screenId && !isGameStart && screenId !== 'welcomeScreen') return;
            if(document.getElementById(currentScreenId)) document.getElementById(currentScreenId).classList.remove('active');
            currentScreenId = screenId; document.getElementById(screenId).classList.add('active');
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => btn.classList.remove('active'));
            const activeNavBtn = document.getElementById(`navBtn${screenId.replace('Screen', '')}`);
            if (activeNavBtn) activeNavBtn.classList.add('active');
            if (isGameStart) {
                document.getElementById('welcomeScreen').classList.remove('active'); 
                bottomNav.style.display = 'flex';
                if (!statInterval) statInterval = setInterval(decreaseStatsGradually, 5000);
                applyLunaCustomization(); 
            }
            if (screenId === 'customizeScreen') applyLunaCustomizationToPreview();
            if (screenId === 'gameScreen') applyLunaCustomization();
            if (screenId === 'minigamesScreen') showGameSelector();
            if (screenId === 'galleryScreen') loadGalleryImage(); 
        }
        
        // --- L√ìGICA DEL JUEGO PRINCIPAL (CUIDAR A LUNA) ---
        function updateStats() {
            const capStat = (val) => Math.max(0, Math.min(100, val));
            gameState.happiness = capStat(gameState.happiness); gameState.energy = capStat(gameState.energy); gameState.hunger = capStat(gameState.hunger);
            document.getElementById('happinessFill').style.width = gameState.happiness + '%';
            document.getElementById('energyFill').style.width = gameState.energy + '%';
            document.getElementById('hungerFill').style.width = gameState.hunger + '%';
            document.getElementById('happinessText').textContent = Math.round(gameState.happiness);
            document.getElementById('energyText').textContent = Math.round(gameState.energy);
            document.getElementById('hungerText').textContent = Math.round(gameState.hunger);
            if (!gameState.giftUnlocked && gameState.interactions >= 7 && gameState.happiness >= 75) {
                gameState.giftUnlocked = true; document.getElementById('navBtnGift').style.opacity = 1; 
                showFloatingText("¬°Luna tiene un REGALO para ti! üéÅ", 3000, true);
            }
        }

        function applyCooldown(actionName, duration = COOLDOWN_TIME) {
            actionCooldowns[actionName] = true;
            const btn = document.getElementById(`btn${actionName.charAt(0).toUpperCase() + actionName.slice(1)}`);
            if(btn) btn.disabled = true;
            setTimeout(() => { actionCooldowns[actionName] = false; if(btn) btn.disabled = false; }, duration);
        }

        function petLuna() { if (actionCooldowns.pet) return; gameState.happiness += 8; gameState.interactions++; showFloatingText("¬°Guau! ‚ù§Ô∏è"); createHearts(document.getElementById('luna')); applyCooldown('pet', 1000); updateStats(); checkAchievements(); }
        function feedLuna() { if (actionCooldowns.feed) return; document.getElementById('luna').classList.add('eating'); gameState.hunger += 25; gameState.happiness += 12; gameState.energy += 5; gameState.interactions++; showFloatingText("¬°Qu√© rico! üçñ"); applyCooldown('feed'); setTimeout(() => document.getElementById('luna').classList.remove('eating'), 1500); updateStats(); checkAchievements(); }
        function playWithLuna() { if (actionCooldowns.play) return; if (gameState.energy < 10) { showFloatingText("Luna est√° muy cansada para jugar... üò¥", 2000); return; } document.getElementById('luna').classList.add('playing'); gameState.happiness += 18; gameState.energy -= 15; gameState.hunger -= 5; gameState.interactions++; showFloatingText("¬°A jugar! üéæ"); applyCooldown('play'); setTimeout(() => document.getElementById('luna').classList.remove('playing'), 1500); updateStats(); checkAchievements(); }
        function brushLuna() { if (actionCooldowns.brush) return; gameState.happiness += 15; gameState.energy += 3; gameState.interactions++; showFloatingText("¬°Qu√© limpia! ‚ú®"); createHearts(document.getElementById('luna')); applyCooldown('brush'); updateStats(); checkAchievements(); }
        function letLunaSleep() { if (actionCooldowns.sleep) return; document.getElementById('luna').classList.add('sleeping'); gameState.energy += 30; gameState.happiness += 5; gameState.hunger -= 5; gameState.interactions++; showFloatingText("Zzz... üí§"); applyCooldown('sleep', 3000); setTimeout(() => document.getElementById('luna').classList.remove('sleeping'), 3000); updateStats(); checkAchievements(); }
        function decreaseStatsGradually() { if (currentScreenId === 'gameScreen') { gameState.hunger = Math.max(0, gameState.hunger - 1); gameState.energy = Math.max(0, gameState.energy - 0.8); if (gameState.hunger < 30 || gameState.energy < 30) gameState.happiness = Math.max(0, gameState.happiness - 0.5); updateStats(); } }
        
        // --- PERSONALIZACI√ìN DE LUNA ---
        function applyLunaCustomization() { 
            const accElement = document.getElementById('lunaAccessory');
            accElement.textContent = lunaCustomization.accessory;
            if (lunaCustomization.accessory) accElement.style.animation = 'bobbingAccessoryFullSize 3s ease-in-out infinite';
            else accElement.style.animation = 'none';
        }
        function applyLunaCustomizationToPreview() { 
            const accPrevElement = document.getElementById('lunaAccessoryPreview');
            accPrevElement.textContent = lunaCustomization.accessory;
            if (lunaCustomization.accessory) accPrevElement.style.animation = 'bobbingAccessoryPreview 3s ease-in-out infinite';
            else accPrevElement.style.animation = 'none';
        }
        function changeLunaAccessory(accessory, clickedElement) { lunaCustomization.accessory = accessory; applyLunaCustomizationToPreview(); applyLunaCustomization(); document.querySelectorAll('.accessory-picker .accessory-option').forEach(opt => opt.classList.remove('selected')); if (clickedElement) clickedElement.classList.add('selected'); }
        
        // --- MINIJUEGOS ---
        function showGameSelector() { document.getElementById('gameSelector').style.display = 'grid'; document.getElementById('memoryGameContainer').style.display = 'none'; document.getElementById('wordleGameContainer').style.display = 'none'; }
        const memoryEmojis = ['üê∂', 'ü¶¥', 'üéæ', 'üè†', 'üíñ', 'üåü', 'üéÇ', 'ü•≥']; let memoryCards = []; let flippedCards = []; let matchedPairs = 0; let memoryScore = 0; let memoryAttempts = 0;
        function startMemoryGame() {document.getElementById('gameSelector').style.display = 'none'; document.getElementById('memoryGameContainer').style.display = 'block'; resetMemoryGame();}
        function createMemoryBoard() { const gameBoard = document.getElementById('memoryGame'); gameBoard.innerHTML = ''; memoryCards = [...memoryEmojis, ...memoryEmojis]; memoryCards.sort(() => 0.5 - Math.random()); memoryCards.forEach((emoji, index) => { const card = document.createElement('div'); card.classList.add('memory-card'); card.dataset.emoji = emoji; card.dataset.index = index; const cardFront = document.createElement('div'); cardFront.classList.add('card-face', 'card-front'); const cardBack = document.createElement('div'); cardBack.classList.add('card-face', 'card-back'); cardBack.textContent = emoji; card.appendChild(cardFront); card.appendChild(cardBack); card.addEventListener('click', () => flipMemoryCard(card)); gameBoard.appendChild(card); }); }
        function flipMemoryCard(card) { if (flippedCards.length < 2 && !card.classList.contains('flipped') && !card.classList.contains('matched')) { card.classList.add('flipped'); flippedCards.push(card); if (flippedCards.length === 2) { memoryAttempts++; document.getElementById('memoryAttempts').textContent = memoryAttempts; setTimeout(checkMemoryMatch, 800); } } }
        function checkMemoryMatch() { const [card1, card2] = flippedCards; if (card1.dataset.emoji === card2.dataset.emoji) { card1.classList.add('matched'); card2.classList.add('matched'); matchedPairs++; memoryScore += 10; if (matchedPairs === memoryEmojis.length) { setTimeout(() => openModal("¬°Ganaste!", `¬°Felicidades, Mayka! Encontraste todas las parejas en ${memoryAttempts} intentos. Tu puntuaci√≥n: ${memoryScore}.`, resetMemoryGame), 300); gameState.happiness += 5; updateStats(); } } else { card1.classList.remove('flipped'); card2.classList.remove('flipped'); memoryScore = Math.max(0, memoryScore - 2); } flippedCards = []; document.getElementById('memoryScore').textContent = memoryScore; }
        function resetMemoryGame() { flippedCards = []; matchedPairs = 0; memoryScore = 0; memoryAttempts = 0; document.getElementById('memoryScore').textContent = memoryScore; document.getElementById('memoryAttempts').textContent = memoryAttempts; createMemoryBoard(); }
        const wordleWords = [ { word: "MAYKA", hint: "NOSE" }, { word: "MARCO", hint: "Nombre del chaval mas sexy, inteligente, guapo, divertido del mundo pero sin la s del final" }, { word: "HUESO", hint: "Cosa que se le da a los perros de las sobras" }, { word: "FELIZ", hint: "Como te queremos ver hoy" },{ word: "REGAL", hint: "Lo que recibes en tu cumple (sin 'o')"} ]; let currentWordleWord = ''; let currentWordleHint = ''; let wordleAttempts = 0; const MAX_WORDLE_ATTEMPTS = 6;
        function startWordleGame() {document.getElementById('gameSelector').style.display = 'none'; document.getElementById('wordleGameContainer').style.display = 'block'; resetWordleGame();}
        function createWordleGrid() { const grid = document.getElementById('wordleGrid'); grid.innerHTML = ''; for (let i = 0; i < MAX_WORDLE_ATTEMPTS * 5; i++) { const cell = document.createElement('div'); cell.classList.add('wordle-cell'); grid.appendChild(cell); } }
        function resetWordleGame() { const randomIndex = Math.floor(Math.random() * wordleWords.length); currentWordleWord = wordleWords[randomIndex].word.toUpperCase(); currentWordleHint = wordleWords[randomIndex].hint; document.getElementById('currentWordHint').textContent = currentWordleHint; wordleAttempts = 0; createWordleGrid(); document.getElementById('wordleInput').value = ''; document.getElementById('wordleInput').disabled = false; }
        function submitWordleGuess() { const guessInput = document.getElementById('wordleInput'); const guess = guessInput.value.toUpperCase(); if (guess.length !== 5) { openModal("Error", "La palabra debe tener 5 letras."); return; } updateWordleGrid(guess); wordleAttempts++; guessInput.value = ''; if (guess === currentWordleWord) { openModal("¬°Correcto!", `¬°Adivinaste la palabra "${currentWordleWord}" en ${wordleAttempts} intentos! Eres genial, Mayka.`, resetWordleGame); gameState.happiness += 7; updateStats(); guessInput.disabled = true; return; } if (wordleAttempts >= MAX_WORDLE_ATTEMPTS) { openModal("Fin del juego", `No adivinaste. La palabra era "${currentWordleWord}". ¬°Int√©ntalo de nuevo!`, resetWordleGame); guessInput.disabled = true; } }
        function updateWordleGrid(guess) { const cells = document.querySelectorAll('#wordleGrid .wordle-cell'); const startIdx = wordleAttempts * 5; const guessArray = guess.split(''); const wordArray = currentWordleWord.split(''); const feedback = Array(5).fill(''); const letterCounts = {}; wordArray.forEach(letter => { letterCounts[letter] = (letterCounts[letter] || 0) + 1; }); for (let i = 0; i < 5; i++) { if (guessArray[i] === wordArray[i]) { feedback[i] = 'correct'; letterCounts[guessArray[i]]--; } } for (let i = 0; i < 5; i++) { if (feedback[i] === '') { if (wordArray.includes(guessArray[i]) && letterCounts[guessArray[i]] > 0) { feedback[i] = 'present'; letterCounts[guessArray[i]]--; } else { feedback[i] = 'absent'; } } } for (let i = 0; i < 5; i++) { const cell = cells[startIdx + i]; cell.textContent = guess[i]; cell.classList.add('filled', feedback[i]); setTimeout(() => cell.classList.remove('filled'), 300); } }
        
        // --- GALER√çA DE IM√ÅGENES ---
        const galleryImagePaths = ["imagen1.png", "imagen2.png", "imagen3.png"]; 
        const galleryImageMessages = [ "Dormilona", "Vaya borrachos", "Pedazo de yonkis" ];
        let currentGalleryIndex = 0;
        const galleryImageElement = document.getElementById('galleryImage');
        const galleryMessageElement = document.getElementById('galleryMessage');
        const galleryCounterElement = document.getElementById('galleryCounter');
        const prevImageBtn = document.getElementById('prevImageBtn');
        const nextImageBtn = document.getElementById('nextImageBtn');
        function loadGalleryImage() { if (galleryImagePaths.length === 0) { galleryImageElement.alt = "No hay im√°genes en la galer√≠a."; galleryImageElement.src = ""; galleryMessageElement.textContent = "A√∫n no hay recuerdos aqu√≠."; galleryCounterElement.textContent = "0 de 0"; prevImageBtn.disabled = true; nextImageBtn.disabled = true; return; } galleryImageElement.src = galleryImagePaths[currentGalleryIndex]; galleryImageElement.alt = `Recuerdo ${currentGalleryIndex + 1}`; galleryMessageElement.textContent = galleryImageMessages[currentGalleryIndex] || "¬°Un recuerdo especial!"; galleryCounterElement.textContent = `Imagen ${currentGalleryIndex + 1} de ${galleryImagePaths.length}`; prevImageBtn.disabled = currentGalleryIndex === 0; nextImageBtn.disabled = currentGalleryIndex === galleryImagePaths.length - 1; }
        function nextGalleryImage() { if (currentGalleryIndex < galleryImagePaths.length - 1) { currentGalleryIndex++; loadGalleryImage(); } }
        function prevGalleryImage() { if (currentGalleryIndex > 0) { currentGalleryIndex--; loadGalleryImage(); } }
        
        // --- MODAL ---
        const infoModal = document.getElementById('infoModal'); const modalTitle = document.getElementById('modalTitle'); const modalBody = document.getElementById('modalBody'); let afterCloseCallback = null;
        function openModal(title, bodyHTML, onCloseCallback = null) { modalTitle.textContent = title; modalBody.innerHTML = bodyHTML; infoModal.classList.add('active'); afterCloseCallback = onCloseCallback; }
        function closeModal() { infoModal.classList.remove('active'); if (afterCloseCallback) { afterCloseCallback(); afterCloseCallback = null;  } }
        
        // --- EFECTOS VISUALES (CORAZONES, TEXTO FLOTANTE) ---
        function createHearts(targetElementContainer) { const heartsContainer = document.getElementById('hearts'); for (let i = 0; i < 5; i++) { setTimeout(() => { const heart = document.createElement('div'); heart.className = 'heart'; heart.textContent = ['üíñ', '‚ù§Ô∏è', 'üíï'][Math.floor(Math.random() * 3)]; heart.style.left = (Math.random() * 80 - 40) + 'px'; heart.style.top = (Math.random() * 80 - 40) + 'px'; heartsContainer.appendChild(heart); setTimeout(() => heart.remove(), 1900); }, i * 150); } }
        function showFloatingText(text, duration = 2000, important = false) { const floatingTextElement = document.getElementById('floatingText'); floatingTextElement.textContent = text; floatingTextElement.style.display = 'block'; if (important) floatingTextElement.style.backgroundColor = 'rgba(255, 107, 107, 0.7)'; else floatingTextElement.style.backgroundColor = 'rgba(0,0,0,0.5)'; setTimeout(() => { floatingTextElement.style.display = 'none'; }, duration - 100); }
        
        // --- LOGROS ---
        const achievementList = { 'happy_luna': { text: 'Super Cuidadora üåü (Luna muy feliz)', condition: () => gameState.happiness >= 90 }, 'active_player': { text: 'Muy Interactiva üèÉ‚Äç‚ôÄÔ∏è (Muchas acciones)', condition: () => gameState.interactions >= 10 }, 'good_feeder': { text: 'Chef Canina üçñ (Luna bien alimentada)', condition: () => gameState.hunger >= 90 && gameState.happiness > 60}, 'energy_master': { text: 'Experta en Descanso üò¥ (Luna con mucha energ√≠a)', condition: () => gameState.energy >= 90 && gameState.happiness > 60}, 'all_rounder': { text: 'Cuidadora Total ‚≠ê (Stats altos)', condition: () => gameState.happiness >= 70 && gameState.energy >= 70 && gameState.hunger >= 70} };
        function checkAchievements() { let newAchievementFound = false; for (const key in achievementList) { if (!gameState.achievements.includes(key) && achievementList[key].condition()) { gameState.achievements.push(key); document.getElementById('achievementMessage').textContent = 'üèÜ ¬°Logro: ' + achievementList[key].text + '!'; newAchievementFound = true; } } if (newAchievementFound) setTimeout(() => document.getElementById('achievementMessage').textContent = '', 3000); }
        
        // --- PANTALLA DE REGALO FINAL ---
        function openGift() { const giftBox = document.getElementById('giftBox'); const finalMessage = document.getElementById('finalMessage'); giftBox.style.transition = 'transform 0.5s ease, opacity 0.5s ease'; giftBox.style.transform = 'scale(1.5) rotate(15deg)'; giftBox.style.opacity = '0'; setTimeout(() => { giftBox.style.display = 'none'; finalMessage.style.display = 'block'; finalMessage.style.opacity = '0'; finalMessage.style.transition = 'opacity 0.5s ease'; setTimeout(() => finalMessage.style.opacity = '1', 50); }, 500); const achievementsElement = document.getElementById('achievementsList'); if (gameState.achievements.length > 0) achievementsElement.innerHTML = gameState.achievements.map(key => `<li>${achievementList[key].text}</li>`).join(''); else achievementsElement.textContent = '¬°Has sido una amiga incre√≠ble para Luna! üíï'; }
        async function downloadCard() { const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d'); canvas.width = 800; canvas.height = 600; const gradient = ctx.createLinearGradient(0, 0, 800, 600); gradient.addColorStop(0, '#ff9a9e'); gradient.addColorStop(0.5, '#fecfef'); gradient.addColorStop(1, '#ff9a9e'); ctx.fillStyle = gradient; ctx.fillRect(0, 0, 800, 600); ctx.fillStyle = 'rgba(255, 255, 255, 0.2)'; ctx.font = '30px Arial'; for(let i = 0; i < 20; i++) ctx.fillText('üêæ', Math.random() * 800, Math.random() * 600); ctx.fillStyle = '#fff'; ctx.textAlign = 'center'; ctx.shadowColor = 'rgba(0,0,0,0.3)'; ctx.shadowBlur = 5; ctx.shadowOffsetX = 2; ctx.shadowOffsetY = 2; ctx.font = 'bold 52px Comic Sans MS'; ctx.fillText('¬°Feliz Cumplea√±os Mayka!', 400, 100); ctx.font = '28px Comic Sans MS'; ctx.fillText('¬°Qu√© d√≠a tan especial!', 400, 180); ctx.fillText('Espero que te lo pases genial.', 400, 230); ctx.shadowColor = 'transparent'; const imgLuna = new Image(); imgLuna.src = 'LUNA.png'; await new Promise(resolve => { imgLuna.onload = () => { const lunaCardWidth = 150; const lunaCardHeight = (imgLuna.height / imgLuna.width) * lunaCardWidth; ctx.drawImage(imgLuna, 400 - lunaCardWidth / 2, 350 - lunaCardHeight / 2, lunaCardWidth, lunaCardHeight); if (lunaCustomization.accessory) { ctx.font = '50px Arial'; ctx.fillStyle = '#000'; ctx.fillText(lunaCustomization.accessory, 400, 300); } ctx.fillStyle = '#fff'; ctx.font = 'italic 32px Comic Sans MS'; ctx.fillText('Con todo mi amor perruno,', 400, 480); ctx.font = 'bold 36px Comic Sans MS'; ctx.fillText('Luna üê∂üíñ', 400, 530); const link = document.createElement('a'); link.download = 'tarjeta-cumple-mayka-luna.png'; link.href = canvas.toDataURL(); link.click(); resolve(); }; imgLuna.onerror = () => { console.error("No se pudo cargar LUNA.png para la tarjeta."); ctx.fillStyle = '#fff'; ctx.font = 'italic 32px Comic Sans MS'; ctx.fillText('Con todo mi amor perruno,', 400, 480); ctx.font = 'bold 36px Comic Sans MS'; ctx.fillText('Luna üê∂üíñ', 400, 530); const link = document.createElement('a'); link.download = 'tarjeta-cumple-mayka-luna.png'; link.href = canvas.toDataURL(); link.click(); resolve(); } }); }
        function restartGame() { gameState = { happiness: 50, energy: 50, hunger: 50, interactions: 0, achievements: [], giftUnlocked: false }; lunaCustomization = { accessory: '' }; changeLunaAccessory('', null); updateStats(); applyLunaCustomization(); applyLunaCustomizationToPreview(); document.getElementById('achievementMessage').textContent = ''; document.getElementById('giftScreen').classList.remove('active'); document.getElementById('giftBox').style.display = 'block'; document.getElementById('giftBox').style.opacity = '1'; document.getElementById('giftBox').style.transform = 'scale(1)'; document.getElementById('finalMessage').style.display = 'none'; bottomNav.style.display = 'none'; currentGalleryIndex = 0; navigateTo('welcomeScreen'); animateWelcome(); if (statInterval) { clearInterval(statInterval); statInterval = null; } }
        
        // --- INICIALIZACI√ìN ---
        window.onload = () => {
            animateWelcome(); updateStats(); applyLunaCustomizationToPreview(); 
            const defaultAccessoryOption = document.querySelector('.accessory-picker .accessory-option.text-label');
            if (defaultAccessoryOption) defaultAccessoryOption.classList.add('selected');
            if (galleryImagePaths.length > 0 && galleryImageMessages.length >= galleryImagePaths.length) loadGalleryImage(); 
            else { 
                 galleryImageElement.alt = "No hay im√°genes disponibles."; galleryImageElement.src = "";
                 galleryMessageElement.textContent = "A√∫n no hay recuerdos aqu√≠.";
                 galleryCounterElement.textContent = "0 de 0";
                 prevImageBtn.disabled = true; nextImageBtn.disabled = true; 
            }
            applyLunaCustomization(); 
        };
    </script>
</body>
</html>